<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>hexo-theme-doc-seed |  </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/images/favicon.ico">

    

  </head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"path":"book/web3-contract-basic-interaction.html","title":""},"data":{"navigation":{"logo":{"text":"Mastering Ethereum. Русский перевод","type":"link","path":"index.html"},"main":[{"text":"Оглавление","type":"label"},{"text":"Предисловие","type":"link","path":"book/preface.html"},{"text":"Глоссарий","type":"link","path":"book/glossary.html"},{"text":"Что такое Ethereum","type":"link","path":"book/what-is.html"},{"text":"Введение","type":"link","path":"book/intro.html"},{"text":"Клиенты Ethereum","type":"link","path":"book/clients.html"},{"text":"Тестнет Ethereum","type":"link","path":"book/ethereum-testnets.html"},{"text":"Ключи и Адреса","type":"link","path":"book/keys-addresses.html"},{"text":"Кошельки","type":"link","path":"book/wallets.html"},{"text":"Транзакции","type":"link","path":"book/transactions.html"},{"text":"Смарт контракты","type":"link","path":"book/smart-contracts.html"},{"text":"Инструменты разработчика и фреймворки","type":"link","path":"book/dev-tools.html"},{"text":"Токены","type":"link","path":"book/tokens.html"},{"text":"DApps","type":"link","path":"book/dapps.html"},{"text":"Ораклы","type":"link","path":"book/oracles.html"},{"text":"Accounting & Gas","type":"link","path":"book/gas.html"},{"text":"EVM","type":"link","path":"book/evm.html"},{"text":"Консенсус","type":"link","path":"book/consensus.html"},{"text":"Vyper","type":"link","path":"book/vyper.html"},{"text":"Протокол DevP2P","type":"link","path":"book/devp2p-protocol.html"},{"text":"Стандарты Ethereum (EIPs/ERCs)","type":"link","path":"book/standards-eip-erc.html"},{"text":"История форков (DAO/ETC)","type":"link","path":"book/forks-history.html"},{"text":"Дополнительно","type":"label"},{"text":"Комментировать на Github","type":"link","path":"https://github.com/ethereumbook-ru/ethereumbook-ru.github.io/issues/new"}]}},"config":{"timezone":"UTC","root":"/","time_format":"HH:mm:ss","theme":"../node_modules/hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/index.html" class="doc-navbar__logo"><img src="/images/logo.png" class="doc-navbar__logo__img"/><span class="doc-navbar__logo__text">Mastering Ethereum. Русский перевод</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <p>== web3.js Contract basic interaction in a non-blocked (async) fashion</p>
<p>=== Description<br>This script is for educational use and is based on <a href="mailto:web3@1.0.0-beta.29" target="_blank" rel="noopener">web3@1.0.0-beta.29</a> web3.js version.</p>
<p>It should be see as an introduction to web3.js.</p>
<p>The web3.js library is a collection of modules which contain specific functionality for the Ethereum ecosystem.</p>
<p>The web3.js object is an umbrella package to house all Ethereum related modules.</p>
<p>This is the Ethereum compatible JavaScript API which implements the Generic JSON RPC spec.</p>
<p>It run in a non-blocked (async) mode to accommodate in many of the methods provided by web3.js</p>
<p>The most remarkable thing about this script is that you don’t need to run your own local node to use it, because it use the <a href="https://infura.io[Infura" target="_blank" rel="noopener">https://infura.io[Infura</a> services].</p>
<p>Anyway, I could adapt this script to be used with a local running node if it seems interesting.</p>
<p>=== Prepare the environment<br>To see this script in action you should follow this simple steps.</p>
<h2 id="Check-you-have-a-valid-npm-version"><a href="#Check-you-have-a-valid-npm-version" class="headerlink" title="==== Check you have a valid npm version"></a>==== Check you have a valid npm version</h2><p>$ npm -v</p>
<h2 id="5-6-0"><a href="#5-6-0" class="headerlink" title="5.6.0"></a>5.6.0</h2><h2 id="If-you-don’t-have-already-done-initialize-your-package"><a href="#If-you-don’t-have-already-done-initialize-your-package" class="headerlink" title="==== If you don’t have already done, initialize your package"></a>==== If you don’t have already done, initialize your package</h2><h2 id="npm-init"><a href="#npm-init" class="headerlink" title="$ npm init"></a>$ npm init</h2><h2 id="Install-basic-dependences"><a href="#Install-basic-dependences" class="headerlink" title="==== Install basic dependences"></a>==== Install basic dependences</h2><p>npm i command-line-args<br>npm i web3</p>
<h2 id="npm-i-node-rest-client-promise"><a href="#npm-i-node-rest-client-promise" class="headerlink" title="npm i node-rest-client-promise"></a>npm i node-rest-client-promise</h2><p>This will update your package.json cofiguracion file with your new dependences.</p>
<p>==== Node.js script execution</p>
<h2 id="Basic-execution"><a href="#Basic-execution" class="headerlink" title="Basic execution"></a>Basic execution</h2><h2 id="code-web3js-web3-contract-basic-interaction-js"><a href="#code-web3js-web3-contract-basic-interaction-js" class="headerlink" title="code/web3js/web3-contract-basic-interaction.js"></a>code/web3js/web3-contract-basic-interaction.js</h2><h2 id="Use-your-own-Infura-Token"><a href="#Use-your-own-Infura-Token" class="headerlink" title="Use your own Infura Token"></a>Use your own Infura Token</h2><p>code/web3js/web3-contract-basic-interaction.js –infuraFileToken /path/to/file/with/infura_token</p>
<p>or</p>
<h2 id="code-web3js-web3-contract-basic-interaction-js-path-to-file-with-infura-token"><a href="#code-web3js-web3-contract-basic-interaction-js-path-to-file-with-infura-token" class="headerlink" title="code/web3js/web3-contract-basic-interaction.js /path/to/file/with/infura_token"></a>code/web3js/web3-contract-basic-interaction.js /path/to/file/with/infura_token</h2><p>== What the hell this script do?<br>This script try to introduce to the basic use of web3.js</p>
<p>Despite some utilities provided by the script what it really do is …</p>
<p>=== web3 provider<br>We use web3.js Web3 object to obtain a basic web3 provider.</p>
<hr>
<h2 id="var-web3-new-Web3-infura-host"><a href="#var-web3-new-Web3-infura-host" class="headerlink" title="var web3 = new Web3(infura_host);"></a>var web3 = new Web3(infura_host);</h2><p>=== Let’s do some basic interactions at web3 level<br>Let’s see the Protocol Version.</p>
<hr>
<p>web3.eth.getProtocolVersion().then(function(protocolVersion) {<br>      console.log(<code>Protocol Version: ${protocolVersion}</code>);</p>
<h2 id=""><a href="#" class="headerlink" title="  })"></a>  })</h2><p>Now I’m curious about the current gas price.</p>
<hr>
<p>web3.eth.getGasPrice().then(function(gasPrice) {<br>      console.log(<code>Gas Price: ${gasPrice}</code>);</p>
<h2 id="-1"><a href="#-1" class="headerlink" title="  })"></a>  })</h2><p>And, Whats the last mined block in my chain?</p>
<hr>
<p>web3.eth.getBlockNumber().then(function(blockNumber) {<br>      console.log(<code>Block Number: ${blockNumber}</code>);</p>
<h2 id="-2"><a href="#-2" class="headerlink" title="  })"></a>  })</h2><p>=== Now let’s dive into some basics actions with a contract<br>We will use the contract at;<br><a href="https://kovan.etherscan.io/address/0xd0a1e359811322d97991e03f863a0c30c2cf029c#code" target="_blank" rel="noopener">https://kovan.etherscan.io/address/0xd0a1e359811322d97991e03f863a0c30c2cf029c#code</a></p>
<p>First things first, let’s initialize our contract address.</p>
<hr>
<h2 id="var-our-contract-address-“0xd0A1E359811322d97991E03f863a0C30C2cF029C”"><a href="#var-our-contract-address-“0xd0A1E359811322d97991E03f863a0C30C2cF029C”" class="headerlink" title="var our_contract_address = “0xd0A1E359811322d97991E03f863a0C30C2cF029C”;"></a>var our_contract_address = “0xd0A1E359811322d97991E03f863a0C30C2cF029C”;</h2><p>Let’s see its balance.</p>
<hr>
<p>web3.eth.getBalance(our_contract_address).then(function(balance) {<br>      console.log(<code>Balance of ${our_contract_address}: ${balance}</code>);</p>
<h2 id="-3"><a href="#-3" class="headerlink" title="})"></a>})</h2><p>Now let’s see its byte code.</p>
<hr>
<p>web3.eth.getCode(our_contract_address).then(function(code) {<br>      console.log(code);</p>
<h2 id="-4"><a href="#-4" class="headerlink" title="})"></a>})</h2><p>=== Now we are going to deal with the contract<br>We prepare our environment to interact with the Etherescan explorer API.</p>
<p>Let’s initialize our contract url in the Etherescan explorer API for the Kovan chain.</p>
<hr>
<h2 id="var-etherescan-url-http-kovan-etherscan-io-api-module-contract-amp-action-getabi-amp-address-our-contract-address"><a href="#var-etherescan-url-http-kovan-etherscan-io-api-module-contract-amp-action-getabi-amp-address-our-contract-address" class="headerlink" title="var etherescan_url = http://kovan.etherscan.io/api?module=contract&amp;action=getabi&amp;address=${our_contract_address}"></a>var etherescan_url = <code>http://kovan.etherscan.io/api?module=contract&amp;action=getabi&amp;address=${our_contract_address}</code></h2><p>And now get a rest client to operate with.</p>
<hr>
<h2 id="var-client-require-‘node-rest-client-promise’-Client"><a href="#var-client-require-‘node-rest-client-promise’-Client" class="headerlink" title="var client = require(‘node-rest-client-promise’).Client();"></a>var client = require(‘node-rest-client-promise’).Client();</h2><p>Let’s get a client promise.</p>
<hr>
<h2 id="client-getPromise-etherescan-url"><a href="#client-getPromise-etherescan-url" class="headerlink" title="client.getPromise(etherescan_url)"></a>client.getPromise(etherescan_url)</h2><p>And once we got a valid client promise, then we can use it.</p>
<h2 id="Now-we-get-here-our-contract-ABI-from-the-client-promise-from-the-Etherescan-explorer"><a href="#Now-we-get-here-our-contract-ABI-from-the-client-promise-from-the-Etherescan-explorer" class="headerlink" title="Now we get here our contract ABI from the client promise (from the Etherescan explorer)."></a>Now we get here our contract ABI from the client promise (from the Etherescan explorer).</h2><p>.then((client_promise) =&gt; {</p>
<h2 id="our-contract-abi-JSON-parse-client-promise-data-result"><a href="#our-contract-abi-JSON-parse-client-promise-data-result" class="headerlink" title="  our_contract_abi = JSON.parse(client_promise.data.result);"></a>  our_contract_abi = JSON.parse(client_promise.data.result);</h2><h2 id="And-now-we-create-our-contract-object-as-a-promise-to-consume-later"><a href="#And-now-we-create-our-contract-object-as-a-promise-to-consume-later" class="headerlink" title="And now we create our contract object as a promise to consume later."></a>And now we create our contract object as a promise to consume later.</h2><p>  return new Promise((resolve, reject) =&gt; {<br>      var our_contract = new web3.eth.Contract(our_contract_abi, our_contract_address);<br>      try {<br>        // If all goes well<br>        resolve(our_contract);<br>      } catch (ex) {<br>        // If something goes wrong<br>        reject(ex);<br>      }<br>    });</p>
<h2 id="-5"><a href="#-5" class="headerlink" title="})"></a>})</h2><h2 id="If-our-contract-promise-return-well-let’s-consume-it"><a href="#If-our-contract-promise-return-well-let’s-consume-it" class="headerlink" title="If our contract promise return well let’s consume it."></a>If our contract promise return well let’s consume it.</h2><h2 id="then-our-contract-gt"><a href="#then-our-contract-gt" class="headerlink" title=".then((our_contract) =&gt; {"></a>.then((our_contract) =&gt; {</h2><h2 id="Let’s-see-our-contract-address"><a href="#Let’s-see-our-contract-address" class="headerlink" title="Let’s see our contract address."></a>Let’s see our contract address.</h2><h2 id="console-log-Our-Contract-address-our-contract-address"><a href="#console-log-Our-Contract-address-our-contract-address" class="headerlink" title="console.log(Our Contract address:  ${our_contract._address});"></a>console.log(<code>Our Contract address:  ${our_contract._address}</code>);</h2><h2 id="or-in-this-other-way"><a href="#or-in-this-other-way" class="headerlink" title="or in this other way."></a>or in this other way.</h2><h2 id="console-log-Our-Contract-address-in-other-way-our-contract-options-address"><a href="#console-log-Our-Contract-address-in-other-way-our-contract-options-address" class="headerlink" title="console.log(Our Contract address in other way:  ${our_contract.options.address});"></a>console.log(<code>Our Contract address in other way:  ${our_contract.options.address}</code>);</h2><h2 id="Now-our-contract-abi"><a href="#Now-our-contract-abi" class="headerlink" title="Now our contract abi."></a>Now our contract abi.</h2><h2 id="console-log-“Our-contract-abi-“-JSON-stringify-our-contract-options-jsonInterface"><a href="#console-log-“Our-contract-abi-“-JSON-stringify-our-contract-options-jsonInterface" class="headerlink" title="console.log(“Our contract abi: “ + JSON.stringify(our_contract.options.jsonInterface));"></a>console.log(“Our contract abi: “ + JSON.stringify(our_contract.options.jsonInterface));</h2><p>=== This is turning more interesting, let’s see what’s going on with our contract<br>Now let’s see our contract total supply in a callback fashion;</p>
<hr>
<p>our_contract.methods.totalSupply().call(function(err, totalSupply) {<br>    if (!err) {<br>        console.log(<code>Total Supply with a callback:  ${totalSupply}</code>);<br>    } else {<br>        console.log(err);<br>    }</p>
<h2 id="-6"><a href="#-6" class="headerlink" title="});"></a>});</h2><h2 id="Or-you-can-use-the-returned-Promise-instead-of-passing-in-the-callback"><a href="#Or-you-can-use-the-returned-Promise-instead-of-passing-in-the-callback" class="headerlink" title="Or you can use the returned Promise instead of passing in the callback;"></a>Or you can use the returned Promise instead of passing in the callback;</h2><p>our_contract.methods.totalSupply().call().then(function(totalSupply){<br>    console.log(<code>Total Supply with a promise:  ${totalSupply}</code>);<br>}).catch(function(err) {<br>    console.log(err);</p>
<h2 id="-7"><a href="#-7" class="headerlink" title="});"></a>});</h2>
        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script>

    

  </body>
</html>
