<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>hexo-theme-doc-seed |  </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/images/favicon.ico">

    

  </head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"path":"book/web3-contract-basic-interaction-async-await.html","title":""},"data":{"navigation":{"logo":{"text":"Mastering Ethereum. Русский перевод","type":"link","path":"index.html"},"main":[{"text":"Оглавление","type":"label"},{"text":"Предисловие","type":"link","path":"book/preface.html"},{"text":"Глоссарий","type":"link","path":"book/glossary.html"},{"text":"Что такое Ethereum","type":"link","path":"book/what-is.html"},{"text":"Введение","type":"link","path":"book/intro.html"},{"text":"Клиенты Ethereum","type":"link","path":"book/clients.html"},{"text":"Тестнет Ethereum","type":"link","path":"book/ethereum-testnets.html"},{"text":"Ключи и Адреса","type":"link","path":"book/keys-addresses.html"},{"text":"Кошельки","type":"link","path":"book/wallets.html"},{"text":"Транзакции","type":"link","path":"book/transactions.html"},{"text":"Смарт контракты","type":"link","path":"book/smart-contracts.html"},{"text":"Инструменты разработчика и фреймворки","type":"link","path":"book/dev-tools.html"},{"text":"Токены","type":"link","path":"book/tokens.html"},{"text":"DApps","type":"link","path":"book/dapps.html"},{"text":"Ораклы","type":"link","path":"book/oracles.html"},{"text":"Accounting & Gas","type":"link","path":"book/gas.html"},{"text":"EVM","type":"link","path":"book/evm.html"},{"text":"Консенсус","type":"link","path":"book/consensus.html"},{"text":"Vyper","type":"link","path":"book/vyper.html"},{"text":"Протокол DevP2P","type":"link","path":"book/devp2p-protocol.html"},{"text":"Стандарты Ethereum (EIPs/ERCs)","type":"link","path":"book/standards-eip-erc.html"},{"text":"История форков (DAO/ETC)","type":"link","path":"book/forks-history.html"},{"text":"Дополнительно","type":"label"},{"text":"Комментировать на Github","type":"link","path":"https://github.com/ethereumbook-ru/ethereumbook-ru.github.io/issues/new"}]}},"config":{"timezone":"UTC","root":"/","time_format":"HH:mm:ss","theme":"../node_modules/hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/index.html" class="doc-navbar__logo"><img src="/images/logo.png" class="doc-navbar__logo__img"/><span class="doc-navbar__logo__text">Mastering Ethereum. Русский перевод</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <p>== web3.js contract basic interaction (async/await) as if they were synchronous functions</p>
<p>=== Description<br>This script is for educational use and is based on <a href="mailto:web3@1.0.0-beta.29" target="_blank" rel="noopener">web3@1.0.0-beta.29</a> web3.js version.</p>
<p>It should be see as an introduction to web3.js.</p>
<p>The web3.js library is a collection of modules which contain specific functionality for the Ethereum ecosystem.</p>
<p>The web3.js object is an umbrella package to house all Ethereum related modules.</p>
<p>This is the Ethereum compatible JavaScript API which implements the Generic JSON RPC spec.</p>
<p>It run in a blocked (async/await) mode to move the reader away from the hell of the Promises as long as their version of nodejs or javascript allows it.</p>
<p>The most remarkable thing about this script is that you don’t need to run your own local node to use it, because it use the <a href="https://infura.io[Infura" target="_blank" rel="noopener">https://infura.io[Infura</a> services].</p>
<p>=== Prepare the environment<br>To see this script in action you should follow this simple steps.</p>
<h2 id="Check-you-have-a-valid-npm-version"><a href="#Check-you-have-a-valid-npm-version" class="headerlink" title="==== Check you have a valid npm version"></a>==== Check you have a valid npm version</h2><p>$ npm -v</p>
<h2 id="5-6-0"><a href="#5-6-0" class="headerlink" title="5.6.0"></a>5.6.0</h2><h2 id="If-you-don’t-have-already-done-initialize-your-package"><a href="#If-you-don’t-have-already-done-initialize-your-package" class="headerlink" title="==== If you don’t have already done, initialize your package"></a>==== If you don’t have already done, initialize your package</h2><h2 id="npm-init"><a href="#npm-init" class="headerlink" title="$ npm init"></a>$ npm init</h2><h2 id="Install-basic-dependences"><a href="#Install-basic-dependences" class="headerlink" title="==== Install basic dependences"></a>==== Install basic dependences</h2><p>npm i web3</p>
<h2 id="npm-i-node-rest-client-promise"><a href="#npm-i-node-rest-client-promise" class="headerlink" title="npm i node-rest-client-promise"></a>npm i node-rest-client-promise</h2><p>This will update your package.json cofiguracion file with your new dependences.</p>
<p>==== Node.js script execution</p>
<h2 id="Execution-example"><a href="#Execution-example" class="headerlink" title="Execution example;"></a>Execution example;</h2><h2 id="code-web3js-web3-contract-basic-interaction-async-await-js"><a href="#code-web3js-web3-contract-basic-interaction-async-await-js" class="headerlink" title="code/web3js/./web3-contract-basic-interaction-async-await.js"></a>code/web3js/./web3-contract-basic-interaction-async-await.js</h2><p>== What the hell this script do?<br>This script try to introduce to the basic use of web3.js using async/await (less Code), as if they were synchronous functions that return values ​​directly instead of promises.</p>
<p>=== web3 provider<br>We use web3.js Web3 object to obtain a basic web3 provider.</p>
<hr>
<h2 id="var-web3-new-Web3-infura-host"><a href="#var-web3-new-Web3-infura-host" class="headerlink" title="var web3 = new Web3(infura_host);"></a>var web3 = new Web3(infura_host);</h2><p>=== Let’s do some basic interactions at web3 level<br>Let’s get the Protocol Version.</p>
<hr>
<h2 id="var-protocolVersion-await-web3-eth-getProtocolVersion"><a href="#var-protocolVersion-await-web3-eth-getProtocolVersion" class="headerlink" title="var protocolVersion = await web3.eth.getProtocolVersion();"></a>var protocolVersion = await web3.eth.getProtocolVersion();</h2><p>Now I’m curious about the current gas price.</p>
<hr>
<h2 id="var-gasPrice-await-web3-eth-getGasPrice"><a href="#var-gasPrice-await-web3-eth-getGasPrice" class="headerlink" title="var gasPrice = await web3.eth.getGasPrice();"></a>var gasPrice = await web3.eth.getGasPrice();</h2><p>And, Whats the last mined block in my chain?</p>
<hr>
<h2 id="var-blockNumber-await-web3-eth-getBlockNumber"><a href="#var-blockNumber-await-web3-eth-getBlockNumber" class="headerlink" title="var blockNumber = await web3.eth.getBlockNumber();"></a>var blockNumber = await web3.eth.getBlockNumber();</h2><p>=== Now let’s dive into some basics actions with a contract<br>We will use the contract at;<br><a href="https://kovan.etherscan.io/address/0xd0a1e359811322d97991e03f863a0c30c2cf029c#code" target="_blank" rel="noopener">https://kovan.etherscan.io/address/0xd0a1e359811322d97991e03f863a0c30c2cf029c#code</a></p>
<p>First things first, let’s initialize our contract address.</p>
<hr>
<h2 id="var-our-contract-address-“0xd0A1E359811322d97991E03f863a0C30C2cF029C”"><a href="#var-our-contract-address-“0xd0A1E359811322d97991E03f863a0C30C2cF029C”" class="headerlink" title="var our_contract_address = “0xd0A1E359811322d97991E03f863a0C30C2cF029C”;"></a>var our_contract_address = “0xd0A1E359811322d97991E03f863a0C30C2cF029C”;</h2><p>Let’s get its balance.</p>
<hr>
<h2 id="var-balance-await-web3-eth-getBalance-our-contract-address"><a href="#var-balance-await-web3-eth-getBalance-our-contract-address" class="headerlink" title="var balance = await web3.eth.getBalance(our_contract_address);"></a>var balance = await web3.eth.getBalance(our_contract_address);</h2><p>Now let’s get its byte code.</p>
<hr>
<h2 id="var-code-await-web3-eth-getCode-our-contract-address"><a href="#var-code-await-web3-eth-getCode-our-contract-address" class="headerlink" title="var code = await web3.eth.getCode(our_contract_address);"></a>var code = await web3.eth.getCode(our_contract_address);</h2><p>=== Now we are going to deal with the contract<br>We prepare our environment to interact with the Etherescan explorer API.</p>
<p>Let’s initialize our contract url in the Etherescan explorer API for the Kovan chain.</p>
<hr>
<h2 id="var-etherescan-url-http-kovan-etherscan-io-api-module-contract-amp-action-getabi-amp-address-our-contract-address"><a href="#var-etherescan-url-http-kovan-etherscan-io-api-module-contract-amp-action-getabi-amp-address-our-contract-address" class="headerlink" title="var etherescan_url = http://kovan.etherscan.io/api?module=contract&amp;action=getabi&amp;address=${our_contract_address}"></a>var etherescan_url = <code>http://kovan.etherscan.io/api?module=contract&amp;action=getabi&amp;address=${our_contract_address}</code></h2><p>And now get a rest client to operate with.</p>
<hr>
<h2 id="var-client-require-‘node-rest-client-promise’-Client"><a href="#var-client-require-‘node-rest-client-promise’-Client" class="headerlink" title="var client = require(‘node-rest-client-promise’).Client();"></a>var client = require(‘node-rest-client-promise’).Client();</h2><p>Let’s get the client response.</p>
<hr>
<h2 id="var-etherescan-response-await-client-getPromise-etherescan-url"><a href="#var-etherescan-response-await-client-getPromise-etherescan-url" class="headerlink" title="var etherescan_response = await client.getPromise(etherescan_url)"></a>var etherescan_response = await client.getPromise(etherescan_url)</h2><p>Now we get here our contract ABI from the client response (from the Etherescan explorer).</p>
<hr>
<h2 id="our-contract-abi-JSON-parse-etherescan-response-data-result"><a href="#our-contract-abi-JSON-parse-etherescan-response-data-result" class="headerlink" title="our_contract_abi = JSON.parse(etherescan_response.data.result);"></a>our_contract_abi = JSON.parse(etherescan_response.data.result);</h2><p>Let’s instantiate our contract object</p>
<hr>
<h2 id="var-our-contract-await-new-web3-eth-Contract-our-contract-abi-our-contract-address"><a href="#var-our-contract-await-new-web3-eth-Contract-our-contract-abi-our-contract-address" class="headerlink" title="var our_contract = await new web3.eth.Contract(our_contract_abi, our_contract_address);"></a>var our_contract = await new web3.eth.Contract(our_contract_abi, our_contract_address);</h2><h2 id="Let’s-see-our-contract-address"><a href="#Let’s-see-our-contract-address" class="headerlink" title="Let’s see our contract address."></a>Let’s see our contract address.</h2><h2 id="console-log-Our-Contract-address-our-contract-address"><a href="#console-log-Our-Contract-address-our-contract-address" class="headerlink" title="console.log(Our Contract address:  ${our_contract._address});"></a>console.log(<code>Our Contract address:  ${our_contract._address}</code>);</h2><h2 id="or-in-this-other-way"><a href="#or-in-this-other-way" class="headerlink" title="or in this other way."></a>or in this other way.</h2><h2 id="console-log-Our-Contract-address-in-other-way-our-contract-options-address"><a href="#console-log-Our-Contract-address-in-other-way-our-contract-options-address" class="headerlink" title="console.log(Our Contract address in other way:  ${our_contract.options.address});"></a>console.log(<code>Our Contract address in other way:  ${our_contract.options.address}</code>);</h2><h2 id="Now-our-contract-abi"><a href="#Now-our-contract-abi" class="headerlink" title="Now our contract abi."></a>Now our contract abi.</h2><h2 id="console-log-“Our-contract-abi-“-JSON-stringify-our-contract-options-jsonInterface"><a href="#console-log-“Our-contract-abi-“-JSON-stringify-our-contract-options-jsonInterface" class="headerlink" title="console.log(“Our contract abi: “ + JSON.stringify(our_contract.options.jsonInterface));"></a>console.log(“Our contract abi: “ + JSON.stringify(our_contract.options.jsonInterface));</h2><p>=== This is turning more interesting, let’s see what’s going on with our contract<br>Now let’s get our contract total supply.</p>
<hr>
<h2 id="var-totalSupply-await-our-contract-methods-totalSupply-call"><a href="#var-totalSupply-await-our-contract-methods-totalSupply-call" class="headerlink" title="var totalSupply = await our_contract.methods.totalSupply().call();"></a>var totalSupply = await our_contract.methods.totalSupply().call();</h2><p>Now let’s get our contract public variable name.</p>
<hr>
<h2 id="var-name-await-our-contract-methods-name-call"><a href="#var-name-await-our-contract-methods-name-call" class="headerlink" title="var name = await our_contract.methods.name().call();"></a>var name = await our_contract.methods.name().call();</h2><p>Now let’s get our contract public variable symbol.</p>
<hr>
<h2 id="var-symbol-await-our-contract-methods-symbol-call"><a href="#var-symbol-await-our-contract-methods-symbol-call" class="headerlink" title="var symbol = await our_contract.methods.symbol().call();"></a>var symbol = await our_contract.methods.symbol().call();</h2>
        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script>

    

  </body>
</html>
